{% extends 'ecoApp/base.html' %}

{% block content %}
{% load static %}


<div class="initial-content" style="margin-top: 60px;"> 
    <h2>REQUESTS IN PROGRESS</h2>
    <div class="welcome-user">
        <h3>Hello {{ request.user.username }}, modify your requests here!</h3>
    </div>  
</div>


<div class="row justify-content-center mt-4">
    <div class="col-md-7">   
        <div class="row justify-content-center">
            <div class="col-md-9">
                {% for item in session_items %}
                    <div class="request-container mb-4">
                        {% if item.category == 'Electronic device' %}
                            <div class="requests-cards">
                                <div class="card-body">
                                    <h2 class="card-title mb-4">{{ item.name }}</h2>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Units:</strong> {{ item.units }} </p>
                                            <p><strong>Points:</strong> {{ item.points }}</p>
                                            <p><strong>Category:</strong> {{ item.category }}</p>
                                            <p><strong>Brand:</strong> {{ item.brand }}</p>
                                            <p><strong>Status:</strong> {{ item.status }}</p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Observations:</strong></p>
                                            <p>{{ item.observations }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                        {% if item.category == 'Appliance' %}
                            <div class="requests-cards">
                                <div class="card-body">
                                    <h2 class="card-title mb-4">{{ item.name }}</h2>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Units:</strong> {{ item.units }}</p>
                                            <p><strong>Points:</strong> {{ item.points }}</p>
                                            <p><strong>Category:</strong> {{ item.category }}</p>
                                            <p><strong>Brand:</strong> {{ item.brand }}</p>
                                            <p><strong>Status:</strong> {{ item.status }}</p>
                                            <p><strong>Weight:</strong> {{ item.weight }} kg</p>                                    
                                            <p><strong>Dimensions:</strong> {{ item.length }}cm x {{ item.width }}cm x {{ item.depth }}cm</p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Observations:</strong></p>
                                            <p>{{ item.observations }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
                </div>
        </div>
    </div>
    <div class="col-md-3 ">        
        <div class="total-requests-card mb-4 ">
            <h2>Total Request</h2>
            <div class="card-body">                
                <p>Total Points: <span id="total-points">0</span></p>                
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="home-delivery">
                    <label class="form-check-label" for="home-delivery">Request Home Delivery</label>
                </div>                
                <button class="btn btn-primary mt-2" id="send-request-btn">Send Request</button>
            </div>
        </div>
    </div>    
</div>

<script>    
    function calcularPuntosTotales() {
        var totalPuntos = 0;        
        var solicitudes = document.querySelectorAll('.request-container');       
        var unidades, puntos;
        
        solicitudes.forEach(function(solicitud) {            
            var elementosP = solicitud.querySelectorAll('p');  

            elementosP.forEach(function(elemento) {                
                if (elemento.textContent.includes("Units")) {
                    unidades = parseInt(elemento.textContent.split(":")[1].trim());
                }
                if (elemento.textContent.includes("Points")) {
                    puntos = parseInt(elemento.textContent.split(":")[1].trim());
                }
            });            
            if (!isNaN(unidades) && !isNaN(puntos)) {
                totalPuntos += unidades * puntos;
            }
        });       
        document.getElementById('total-points').textContent = totalPuntos;
    }   
    window.onload = function() {
        calcularPuntosTotales();
    };
</script>








{% endblock %}
