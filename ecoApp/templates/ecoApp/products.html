{% extends 'ecoApp/base.html' %}

{% block content %}

{% load static %}

<div class="initial-content" style="margin-top: 60px;"> 
    <h2>PRODUCTS</h2>
    
    {% if request.user.is_authenticated %}
        <div class="welcome-user">
            <h3>Hello {{user}}, you have {{ user.profile.ProfilePoints }} points! </h3>
        </div>
    {% else %}
        <div class="welcome-user">
            <h3>Register now if you want to recycle! </h3>
        </div>
    {% endif %}    
</div>
<div class="products-div">
    <div class="row">
      
        <div class="col-2">   
          <div class="list-group">
            <button type="button" class="list-group-item list-group-item-action active menu-button" aria-current="true">
              Menu
            </button>
              {% for category in categories %}
                <a href="{% url 'products' category.id %}" class="list-group-item list-group-item-action">
                  {{ category }}
                </a>
              {% endfor %}                     
          </div>             
        </div>       

        <div class="col-10">
          <div class="row row-cols-1 row-cols-md-3 g-4">
            {% for element in items %}    <!--Mostra tots els items que estan guardats a la BD -->
              
              <div class="col">
                <div class="card h-100">                  
                  <img src="{{element.ItemImage.url}}" class="card-img-top" alt="...">    
                  <div class="card-body">
                    <h5 class="card-title">{{ element }}</h5>
                    <p class="card-text">{{ element.ItemDescription }}</p>
                    
                    
                  </div>
                  <div class="select-div">
                    <form method="GET" action="">
                      <button type="button" class="btn btn-success shadow select-button" data-bs-toggle="modal" 
                        data-bs-target="#selectItemModal" data-item-name="{{ element }}" 
                        data-item-points="{{ element.Category.CategoryPoints }}">
                        Select
                      </button>                     
                    </form> 
                  </div>
                </div>                 
              </div>                         
            {% endfor %}
          </div>
        </div>   

        <style>
          .card {
            display: flex;
            flex-direction: column;
            height: 100%; 
            padding-top: 30px;
          }     
          .card-image-container {            
            flex: 1; 
            display: flex;
            justify-content: center;
            align-items: center;
          }        
          .card-img-top {
            width: 250px;
            height: 250px; 
            object-fit: cover; 
            margin: auto; 
          }
          .menu-button{
            background-color: #8daf73!important;
          }            
          .select-div{
            align-items: center;
            padding: 20px;

          }
          .select-button{
            width: 100%;           

          }
        </style>
      </div>  
</div>

<!-- select Modal -->
<div class="modal fade" id="selectItemModal" tabindex="-1" aria-labelledby="selectItemModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="selectItemModalLabel">Select Item</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!--CONTINGUT HARDODEJAT DEL SELECT_ITEM_MODAL-->
            <div class="col-md-20">
              {% if request.user.is_authenticated %}        
                  
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">                      
                      <h3 id="modalItemName">Item Name</h3>
                      <!-- <h3>Washing machine</h3>                          -->
                    </div>
                </div>
                <div class="card-body collapse show" id="requestDetails">
                    <div class="row">
                        <div class="col-md-2">
                            <label><strong>Units:</strong></label>
                            <input type="number" value="1" min="1" class="form-control">
                        </div>
                        <div class="col-md-2">
                            <label><strong>Weight (kg):</strong></string></label>
                            <input type="text" value="0" class="form-control">
                        </div>
                        <div class="col-md-2">
                          <label><strong>Brand:</strong></label>
                          <select class="form-select">
                            {% if item.Category.id == 3 %}
                                {% for marca in brands.3 %}
                                    <option value="{{ marca }}">{{ marca }}</option>
                                {% endfor %}
                            {% elif item.Category.id == 4 %}
                                {% for marca in brands.4 %}
                                    <option value="{{ marca }}">{{ marca }}</option>
                                {% endfor %}
                            {% else %}
                                <option>No brands available for this category</option>
                            {% endif %}
                        </select>
                        
                          
                        </div>
                        <div class="col-md-6">
                          <label><strong>Dimensions (cm):</strong></label>
                          <div class="row">
                              <div class="col-md-4">
                                  <div class="input-group">
                                      <div class="d-flex align-items-center">
                                          <p class="m-0">Length</p>
                                      </div>
                                      <span class="input-group-text"><i class=""></i></span>
                                      <input type="text" value="0" placeholder="Length" class="form-control">
                                  </div>
                              </div>
                              <div class="col-md-4">
                                  <div class="input-group">
                                      <div class="d-flex align-items-center">
                                          <p class="m-0">Width</p>
                                      </div>
                                      <span class="input-group-text"><i class=""></i></span>
                                      <input type="text" value="0" placeholder="Width" class="form-control">
                                  </div>
                              </div>
                              <div class="col-md-4">
                                  <div class="input-group">
                                      <div class="d-flex align-items-center">
                                          <p class="m-0">Depth</p>
                                      </div>
                                      <span class="input-group-text"><i class=""></i></span>
                                      <input type="text" value="0" placeholder="Depth" class="form-control">
                                  </div>
                              </div>
                          </div>
                      </div>
                      
                        <div class="col-md-2">
                            <label><strong>Status:</strong></label>
                            <select class="form-select">
                                <option value="New">New</option>
                                <option value="Old">Old</option>
                                <option value="Used">Used</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label><strong>Points:</strong></label>   
                            <span class="form-control" id="modalItemPoints">Item Points</span>
                            <!-- <h3 id="modalItemName">Item Name</h3> -->
                        </div>                              
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <label><strong>Observations:</strong></label>
                            <textarea class="form-control" rows="2"></textarea>
                        </div>
                    </div>
                </div>
                  
              {% else %}
                  <p>You need to be logged in to view this page.</p>
              {% endif %}
          </div>

          <!--*******************************************-->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Add Item</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function(){
      $('.select-button').click(function(){
          var itemName = $(this).data('item-name'); 
          var itemPoints = $(this).data('item-points'); 

          $('#modalItemName').text(itemName); 
          $('#modalItemPoints').text(itemPoints);    

      });
  });
  </script>

{% endblock %}